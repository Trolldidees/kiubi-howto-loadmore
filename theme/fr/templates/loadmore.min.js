/** 
 * Kiubi API - load_more plugin
 * 
 * Copyright 2013 Troll d'idees
 * 
 * exemple d'utilisation :
 * 
 * 	$("div.listing").loadmore({
 *		'api_endpoint' : '/api/v1/catalog/product.json',
 *		'api_params' : {..},
 *		'ui_button' : $('a.load_more'),
 *		'render_item' : function(product) { 
 *			return '<div>' + product.name + '</div>';
 *		}
 *	});
 */
(function(e){e.fn.loadmore=function(f){var a=this,b=e(a[0]),c=e.extend({current_page:0,render_item:function(a){return a},append_item:function(a,c){b.append(c)}},f),d=new kiubi.api_navigator({endpoint:c.api_endpoint,params:c.api_params,current_page:c.current_page});this.getNextPage=function(){return d.getNextPage().done(function(f,b){e.each(b,function(e,b){var d=c.render_item.call(a,b);c.append_item.call(a,b,d);a.trigger("loadmore.append_item",[b,d])});a.trigger("loadmore.append_page");!1===d.hasNextPage()&&
a.trigger("loadmore.complete")})};this.hasNextPage=function(){return d.hasNextPage()};a.trigger("loadmore.init");return this}})(jQuery);